<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:IntegratorMobile.UI.Controls;assembly=IntegratorMobile.UI"
             x:Class="IntegratorMobile.Views.Appointments.AddMilestonePage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource BackgroundSecondary}">
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource Slate700}" Padding="16,12">
            <Grid ColumnDefinitions="Auto,*">
                <Button Text="â€¹ Back"
                        TextColor="White"
                        BackgroundColor="Transparent"
                        FontFamily="InterSemiBold"
                        Clicked="OnBackClicked" />
                <VerticalStackLayout Grid.Column="1" Margin="8,0,0,0">
                    <Label Text="Add Milestone"
                           FontSize="18"
                           FontFamily="InterSemiBold"
                           TextColor="White" />
                    <Label x:Name="WorkItemTitle" Text="Work Item Name"
                           FontSize="14"
                           TextColor="White"
                           Opacity="0.7" />
                </VerticalStackLayout>
            </Grid>
        </Grid>
        
        <!-- Main Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="24">
                
                <!-- Milestone Type Selection -->
                <VerticalStackLayout Spacing="12">
                    <Label Text="Milestone Type"
                           Style="{StaticResource BodyMedium}"
                           FontFamily="InterSemiBold" />
                    
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                        
                        <!-- Before -->
                        <Border x:Name="BeforeOption" Grid.Row="0" Grid.Column="0"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderLight}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 12"
                                Padding="16">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="ðŸ“‹" FontSize="24" />
                                <Label Text="Before"
                                       Style="{StaticResource BodyLarge}"
                                       FontFamily="InterSemiBold" />
                                <Label Text="Document initial condition"
                                       Style="{StaticResource Caption}" />
                            </VerticalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMilestoneTypeSelected" CommandParameter="before" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                        <!-- In Progress -->
                        <Border x:Name="InProgressOption" Grid.Row="0" Grid.Column="1"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderLight}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 12"
                                Padding="16">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="ðŸ”§" FontSize="24" />
                                <Label Text="In Progress"
                                       Style="{StaticResource BodyLarge}"
                                       FontFamily="InterSemiBold" />
                                <Label Text="Document work being done"
                                       Style="{StaticResource Caption}" />
                            </VerticalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMilestoneTypeSelected" CommandParameter="in_progress" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                        <!-- Completed -->
                        <Border x:Name="CompletedOption" Grid.Row="1" Grid.Column="0"
                                BackgroundColor="White"
                                Stroke="{StaticResource Primary600}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 12"
                                Padding="16">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="âœ…" FontSize="24" />
                                <Label Text="Completed"
                                       Style="{StaticResource BodyLarge}"
                                       FontFamily="InterSemiBold"
                                       TextColor="{StaticResource Primary600}" />
                                <Label Text="Document finished work"
                                       Style="{StaticResource Caption}" />
                            </VerticalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMilestoneTypeSelected" CommandParameter="completed" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                        <!-- Custom -->
                        <Border x:Name="CustomOption" Grid.Row="1" Grid.Column="1"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderLight}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 12"
                                Padding="16">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="ðŸ“" FontSize="24" />
                                <Label Text="Custom"
                                       Style="{StaticResource BodyLarge}"
                                       FontFamily="InterSemiBold" />
                                <Label Text="Custom milestone type"
                                       Style="{StaticResource Caption}" />
                            </VerticalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMilestoneTypeSelected" CommandParameter="custom" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                    </Grid>
                </VerticalStackLayout>
                
                <!-- Custom Name (shown when Custom is selected) -->
                <VerticalStackLayout x:Name="CustomNameSection" IsVisible="False" Spacing="8">
                    <Label Text="Milestone Name"
                           Style="{StaticResource BodyMedium}"
                           FontFamily="InterSemiBold">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Milestone Name " />
                                <Span Text="*" TextColor="{StaticResource Error}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <controls:AppInput x:Name="CustomNameInput"
                                      Placeholder="Enter milestone name" />
                </VerticalStackLayout>
                
                <!-- Photos Section -->
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Photos"
                               Style="{StaticResource BodyMedium}"
                               FontFamily="InterSemiBold">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="Photos " />
                                    <Span Text="*" TextColor="{StaticResource Error}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <Label Grid.Column="1" Text="At least 1 required"
                               Style="{StaticResource Caption}" />
                    </Grid>
                    
                    <!-- Photo Grid -->
                    <FlexLayout x:Name="PhotoGrid" 
                                Wrap="Wrap" 
                                Direction="Row"
                                JustifyContent="Start">
                        
                        <!-- Add Photo Button -->
                        <Border WidthRequest="80" HeightRequest="80"
                                BackgroundColor="White"
                                Stroke="{StaticResource BorderMedium}"
                                StrokeThickness="2"
                                StrokeDashArray="4,4"
                                StrokeShape="RoundRectangle 8"
                                Margin="0,0,8,8">
                            <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="4">
                                <Label Text="ðŸ“·" FontSize="24" HorizontalOptions="Center" />
                                <Label Text="Add" Style="{StaticResource Caption}" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnAddPhotoClicked" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                    </FlexLayout>
                    
                    <Label x:Name="PhotoError" Text="At least one photo is required"
                           Style="{StaticResource Caption}"
                           TextColor="{StaticResource Error}"
                           IsVisible="True" />
                </VerticalStackLayout>
                
                <!-- Preview Card (shown when photos added) -->
                <controls:AppCard x:Name="PreviewCard" IsVisible="False">
                    <HorizontalStackLayout Spacing="12">
                        <Border WidthRequest="40" HeightRequest="40"
                                BackgroundColor="{StaticResource SuccessLight}"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 20">
                            <Label Text="âœ“" FontSize="18" 
                                   TextColor="{StaticResource Success}"
                                   HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label x:Name="PreviewName" Text="Completed"
                                   Style="{StaticResource BodyMedium}"
                                   FontFamily="InterSemiBold" />
                            <Label x:Name="PreviewPhotoCount" Text="0 photos"
                                   Style="{StaticResource Caption}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </controls:AppCard>
                
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Footer Actions -->
        <VerticalStackLayout Grid.Row="2" Padding="16" Spacing="8" BackgroundColor="White">
            <BoxView HeightRequest="1" Color="{StaticResource BorderLight}" Margin="0,0,0,8" />
            <controls:AppButton x:Name="SaveButton"
                               Text="SAVE MILESTONE"
                               Variant="Primary"
                               IsBlock="True"
                               IsEnabled="False"
                               Clicked="OnSaveClicked" />
            <controls:AppButton Text="CANCEL"
                               Variant="Outline"
                               IsBlock="True"
                               Clicked="OnCancelClicked" />
        </VerticalStackLayout>
        
    </Grid>
    
</ContentPage>
